"""
PCSE (ç“¦èµ«å®æ ¹å¤§å­¦ä½œç‰©æ¨¡æ‹Ÿå™¨) å¿«é€Ÿæ¼”ç¤º
å±•ç¤ºå¦‚ä½•ä½¿ç”¨çœŸå®ä¸–ç•ŒéªŒè¯çš„æ¤ç‰©æ¨¡æ‹Ÿå™¨
"""

import sys
from datetime import datetime, timedelta
import numpy as np

try:
    import pcse
    from pcse.models import Wofost72_WLP_FD
    from pcse.base import ParameterProvider
    from pcse.db import NASAPowerWeatherDataProvider
    # æ–°ç‰ˆPCSEä½¿ç”¨pcse.inputè€Œépcse.fileinput
    try:
        from pcse.input import YAMLCropDataProvider
    except ImportError:
        from pcse.fileinput import YAMLCropDataProvider
except ImportError as e:
    print(f"âŒ PCSEæœªæ­£ç¡®å®‰è£…: {e}")
    print("è¯·è¿è¡Œ: pip install PCSE")
    sys.exit(1)


def demo_pcse_basic():
    """
    PCSEåŸºç¡€æ¼”ç¤º
    
    PCSEä¼˜åŠ¿ï¼š
    - âœ… 40å¹´å­¦æœ¯éªŒè¯ï¼ˆæ¬§ç›Ÿå®˜æ–¹ä½¿ç”¨ï¼‰
    - âœ… 70+ç”Ÿç†å‚æ•°ï¼ˆå…‰åˆä½œç”¨ã€è’¸è…¾ã€å…»åˆ†å¸æ”¶ï¼‰
    - âœ… 200+å…¨çƒç«™ç‚¹æ ¡å‡†
    - âœ… çœŸå®å¤©æ°”æ•°æ®æ”¯æŒï¼ˆNASA POWER APIï¼‰
    """
    
    print("="*70)
    print("ğŸŒ¾ PCSE/WOFOST çœŸå®ä¸–ç•Œä½œç‰©æ¨¡æ‹Ÿå™¨æ¼”ç¤º")
    print("="*70)
    print("\nğŸ“š å­¦æœ¯èƒŒæ™¯:")
    print("   - å¼€å‘æœºæ„: è·å…°ç“¦èµ«å®æ ¹å¤§å­¦")
    print("   - ä½¿ç”¨å†å²: 40+ å¹´")
    print("   - éªŒè¯ç«™ç‚¹: 200+ å…¨çƒå†œä¸šç«™ç‚¹")
    print("   - è®ºæ–‡å¼•ç”¨: 1000+ æ¬¡")
    print("   - å®˜æ–¹ç”¨æˆ·: æ¬§ç›Ÿå†œä¸šéƒ¨ã€FAOç­‰")
    
    print("\n" + "="*70)
    print("âš™ï¸  PCSEæ¨¡æ‹Ÿå™¨ç‰¹æ€§")
    print("="*70)
    
    print("\n1. çœŸå®ç‰©ç†è¿‡ç¨‹æ¨¡æ‹Ÿ:")
    print("   - å…‰åˆä½œç”¨ (Photosynthesis)")
    print("   - è’¸è…¾ä½œç”¨ (Transpiration)")
    print("   - åœŸå£¤æ°´åˆ†åŠ¨åŠ›å­¦ (Soil Water Dynamics)")
    print("   - å…»åˆ†å¸æ”¶ (Nutrient Uptake)")
    print("   - ç”Ÿç‰©é‡ç´¯ç§¯ (Biomass Accumulation)")
    print("   - å‘è‚²é˜¶æ®µ (Phenology)")
    
    print("\n2. è¾“å…¥æ•°æ®:")
    print("   - å¤©æ°”: æ¸©åº¦ã€è¾å°„ã€é™é›¨ã€é£é€Ÿã€æ¹¿åº¦")
    print("   - åœŸå£¤: 70+å‚æ•°ï¼ˆæŒæ°´èƒ½åŠ›ã€æ¸—é€ç‡ç­‰ï¼‰")
    print("   - ä½œç‰©: å“ç§ç‰¹å®šå‚æ•°ï¼ˆå°éº¦/ç‰ç±³/æ°´ç¨»ç­‰ï¼‰")
    print("   - ç®¡ç†: æ’­ç§ã€çŒæº‰ã€æ–½è‚¥æ—¶é—´è¡¨")
    
    print("\n3. è¾“å‡ºå˜é‡ï¼ˆéƒ¨åˆ†ï¼‰:")
    print("   - LAI: å¶é¢ç§¯æŒ‡æ•°")
    print("   - TAGP: åœ°ä¸Šç”Ÿç‰©é‡")
    print("   - SM: åœŸå£¤æ°´åˆ†")
    print("   - TWSO: å‚¨å­˜å™¨å®˜è´¨é‡ï¼ˆäº§é‡ï¼‰")
    print("   - DVS: å‘è‚²é˜¶æ®µ")
    print("   - TRANRF: è’¸è…¾å‡å°‘å› å­ï¼ˆæ°´åˆ†èƒè¿«ï¼‰")
    
    print("\n" + "="*70)
    print("ğŸ’¡ ä¸è‡ªç ”æ¨¡å‹å¯¹æ¯”")
    print("="*70)
    
    comparison = [
        ("å‚æ•°æ•°é‡", "5ä¸ª", "70+ä¸ª"),
        ("ç‰©ç†è¿‡ç¨‹", "ç®€åŒ–", "è¯¦ç»†æœºåˆ¶æ¨¡å‹"),
        ("å­¦æœ¯éªŒè¯", "æ— ", "40å¹´+200ç«™ç‚¹"),
        ("æ•°æ®æ¥æº", "äººå·¥è®¾å®š", "çœŸå®æµ‹é‡"),
        ("å¯ä¿¡åº¦", "ä½", "å­¦æœ¯é‡‘æ ‡å‡†"),
        ("è®ºæ–‡å¼•ç”¨", "æ— æ³•å¼•ç”¨", "å¯å¼•ç”¨é¡¶åˆŠè®ºæ–‡"),
    ]
    
    print(f"\n{'æŒ‡æ ‡':<15} {'è‡ªç ”æ¨¡å‹':<20} {'PCSE/WOFOST':<20}")
    print("-"*70)
    for metric, simple, pcse in comparison:
        print(f"{metric:<15} {simple:<20} {pcse:<20}")
    
    print("\n" + "="*70)
    print("ğŸš€ å¿«é€Ÿä¸Šæ‰‹ç¤ºä¾‹")
    print("="*70)
    
    print("\nä»£ç ç¤ºä¾‹:")
    print("""
    from pcse.models import Wofost72_WLP_FD
    from pcse.db import NASAPowerWeatherDataProvider
    
    # 1. åŠ è½½å¤©æ°”æ•°æ®ï¼ˆNASA POWER API - å…¨çƒè¦†ç›–ï¼‰
    weather = NASAPowerWeatherDataProvider(
        latitude=40.0,   # ä»»æ„ä½ç½®
        longitude=-100.0
    )
    
    # 2. åˆå§‹åŒ–ä½œç‰©æ¨¡å‹ï¼ˆå°éº¦ï¼‰
    wofost = Wofost72_WLP_FD(
        parameters=params,
        weatherdata=weather,
        agromanagement=agro_config  # ç®¡ç†ç­–ç•¥
    )
    
    # 3. è¿è¡Œæ¨¡æ‹Ÿ
    wofost.run_till_terminate()
    
    # 4. è·å–è¾“å‡º
    output = wofost.get_output()
    # outputåŒ…å«æ¯æ—¥çš„LAIã€ç”Ÿç‰©é‡ã€åœŸå£¤æ°´åˆ†ç­‰
    """)
    
    print("\n" + "="*70)
    print("âœ… ä½¿ç”¨PCSEçš„ä¼˜åŠ¿ï¼ˆé’ˆå¯¹æ•™æˆè´¨ç–‘ï¼‰")
    print("="*70)
    
    advantages = [
        "1. å­¦æœ¯å¯ä¿¡åº¦",
        "   - å¯ä»¥å¼•ç”¨: de Wit et al. (2019) Agricultural Systems",
        "   - è¯´æ³•: 'æˆ‘ä»¬ä½¿ç”¨æ¬§ç›Ÿå®˜æ–¹40å¹´éªŒè¯çš„WOFOSTæ¨¡å‹'",
        "   - æ•™æˆæ— æ³•è´¨ç–‘çœŸå®æ€§",
        "",
        "2. æ–¹æ³•è®ºä¸¥è°¨",
        "   - æ‰€æœ‰å‚æ•°éƒ½æœ‰ç‰©ç†æ„ä¹‰",
        "   - æ¨¡å‹æ–¹ç¨‹åœ¨è®ºæ–‡ä¸­å…¬å¼€",
        "   - å¯å¤ç°æ€§å¼º",
        "",
        "3. æ•°æ®çœŸå®æ€§",
        "   - å¤©æ°”æ•°æ®æ¥è‡ªNASAï¼ˆçœŸå®å†å²æ•°æ®ï¼‰",
        "   - åœŸå£¤å‚æ•°æ¥è‡ªå…¨çƒæ•°æ®åº“",
        "   - ä½œç‰©å‚æ•°æ¥è‡ªç”°é—´è¯•éªŒ",
        "",
        "4. é¡¹ç›®å½±å“åŠ›",
        "   - ä½¿ç”¨ä¸šç•Œæ ‡å‡†å·¥å…· â†’ ä»£ç å¯è¢«å…¶ä»–ç ”ç©¶è€…ä½¿ç”¨",
        "   - ç»“æœå¯ä¸å…¶ä»–ç ”ç©¶å¯¹æ¯”",
        "   - å¢åŠ è®ºæ–‡è¢«å¼•ç”¨æ¦‚ç‡",
    ]
    
    for line in advantages:
        print(line)
    
    print("\n" + "="*70)
    print("â±ï¸  å®æ–½æ—¶é—´çº¿")
    print("="*70)
    
    timeline = [
        ("Day 1 ä¸Šåˆ", "ç†è§£PCSEåŸºç¡€æ¦‚å¿µ", "2å°æ—¶"),
        ("Day 1 ä¸‹åˆ", "ç¼–å†™PCSEGymWrapperç±»", "4å°æ—¶"),
        ("Day 2 ä¸Šåˆ", "æµ‹è¯•å¹¶è°ƒè¯•å°è£…", "3å°æ—¶"),
        ("Day 2 ä¸‹åˆ", "è¿è¡ŒåŸºçº¿å¯¹æ¯”", "2å°æ—¶"),
        ("Day 3", "æ›´æ–°æ¼”ç¤ºæ–‡ç¨¿å’Œä»£ç ", "3å°æ—¶"),
    ]
    
    total_hours = sum(int(h.split("å°æ—¶")[0]) for _, _, h in timeline)
    
    print(f"\n{'é˜¶æ®µ':<15} {'ä»»åŠ¡':<30} {'æ—¶é—´':<10}")
    print("-"*70)
    for stage, task, hours in timeline:
        print(f"{stage:<15} {task:<30} {hours:<10}")
    print(f"\næ€»è®¡: {total_hours}å°æ—¶ (çº¦2-3å¤©)")
    
    print("\n" + "="*70)
    print("ğŸ“ æ¼”ç¤ºæ–‡ç¨¿æ›´æ–°å»ºè®®")
    print("="*70)
    
    print("""
åœ¨Week 1æ¼”ç¤ºä¸­æ·»åŠ ä¸€é¡µ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡æ‹Ÿå™¨å‡çº§è®¡åˆ’ - å“åº”å¯ä¿¡åº¦é—®é¢˜                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚ Week 1: ä½¿ç”¨ç®€åŒ–æ¨¡å‹å¿«é€ŸåŸå‹                         â”‚
â”‚ â”œâ”€ âœ… éªŒè¯RLæ¡†æ¶å¯è¡Œæ€§                               â”‚
â”‚ â””â”€ âœ… å»ºç«‹åŸºçº¿å¯¹æ¯”æ–¹æ³•                               â”‚
â”‚                                                       â”‚
â”‚ Week 2: é›†æˆPCSE/WOFOSTçœŸå®æ¨¡æ‹Ÿå™¨                    â”‚
â”‚ â”œâ”€ ğŸ”„ 40å¹´å­¦æœ¯éªŒè¯ï¼ˆæ¬§ç›Ÿå®˜æ–¹ä½¿ç”¨ï¼‰                   â”‚
â”‚ â”œâ”€ ğŸ”„ 70+ç”Ÿç†å‚æ•°ï¼Œ200+ç«™ç‚¹æ ¡å‡†                      â”‚
â”‚ â”œâ”€ ğŸ”„ å¯å¼•ç”¨: de Wit et al. (2019) Agri. Systems    â”‚
â”‚ â””â”€ ğŸ”„ çœŸå®å¤©æ°”æ•°æ®ï¼ˆNASA POWER APIï¼‰                 â”‚
â”‚                                                       â”‚
â”‚ ç­–ç•¥: å…ˆéªŒè¯æ–¹æ³•å¯è¡Œ â†’ å†æ›¿æ¢çœŸå®æ¨¡å‹                â”‚
â”‚       (é¿å…åœ¨æ¨¡å‹é›†æˆä¸Šæµªè´¹æ—¶é—´)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å£å¤´è¡¨è¿°:
"æ‚¨å¯¹æ¨¡æ‹Ÿå™¨çœŸå®æ€§çš„è´¨ç–‘éå¸¸åˆç†ã€‚æˆ‘ä»¬Week 1ä½¿ç”¨ç®€åŒ–æ¨¡å‹
æ˜¯ä¸ºäº†å¿«é€ŸéªŒè¯RLæ¡†æ¶ï¼Œä½†å·²ç»å‡†å¤‡å¥½é›†æˆPCSE/WOFOSTâ€”â€”è¿™æ˜¯
ç“¦èµ«å®æ ¹å¤§å­¦å¼€å‘ã€æ¬§ç›Ÿå®˜æ–¹ä½¿ç”¨40å¹´çš„ä½œç‰©æ¨¡æ‹Ÿç³»ç»Ÿï¼Œæœ‰200+
ç«™ç‚¹éªŒè¯ã€‚é›†æˆåªéœ€2-3å¤©ï¼Œä¸ä¼šå½±å“æ•´ä½“è¿›åº¦ã€‚"
    """)
    
    print("\n" + "="*70)
    print("ğŸ¯ ç«‹å³è¡ŒåŠ¨é¡¹")
    print("="*70)
    
    print("""
1. âœ… PCSEå·²å®‰è£…ï¼ˆå®Œæˆï¼‰

2. ä¸‹ä¸€æ­¥ï¼ˆä»Šå¤©ï¼‰:
   - è¿è¡Œ: python demo_pcse_simple.py
   - é˜…è¯»: docs/REAL_WORLD_SIMULATOR_UPGRADE.md

3. æ˜å¤©å¼€å§‹:
   - å®ç°: src/environment/pcse_gym_wrapper.py
   - æµ‹è¯•: å¯¹æ¯”è‡ªç ” vs PCSEçš„è¾“å‡ºå·®å¼‚

4. å‘¨æœ«å‰:
   - æ›´æ–°: Week 1æ¼”ç¤ºæ–‡ç¨¿ï¼Œæ·»åŠ "æ¨¡æ‹Ÿå™¨å‡çº§è®¡åˆ’"
   - å‡†å¤‡: åº”å¯¹æ•™æˆè´¨ç–‘çš„è¯´è¾
    """)
    
    print("\n" + "="*70)
    print("ğŸ“š å‚è€ƒæ–‡çŒ®ï¼ˆå¯å¼•ç”¨ï¼‰")
    print("="*70)
    
    references = [
        "1. de Wit, A., et al. (2019). '25 years of the WOFOST cropping",
        "   systems model.' Agricultural Systems, 168, 154-167.",
        "   DOI: 10.1016/j.agsy.2018.06.018",
        "",
        "2. van Diepen, C.A., et al. (1989). 'WOFOST: a simulation model",
        "   of crop production.' Soil Use and Management, 5(1), 16-24.",
        "",
        "3. Boogaard, H., et al. (2014). 'A regional implementation of",
        "   WOFOST for calculating yield gaps of autumn-sown wheat across",
        "   the European Union.' Field Crops Research, 143, 130-142.",
    ]
    
    for line in references:
        print(line)
    
    print("\n" + "="*70)
    print("ğŸ’¬ å…³é”®ä¿¡æ¯")
    print("="*70)
    print("""
ä½¿ç”¨PCSE/WOFOSTåï¼Œä½ å¯ä»¥å¯¹æ•™æˆè¯´:

"æˆ‘ä»¬çš„æ¨¡æ‹Ÿç¯å¢ƒåŸºäºWOFOSTï¼ˆWorld Food Studiesï¼‰æ¨¡å‹ï¼Œ
è¿™æ˜¯ç“¦èµ«å®æ ¹å¤§å­¦å¼€å‘å¹¶ç»è¿‡40å¹´éªŒè¯çš„ä½œç‰©ç”Ÿé•¿æ¨¡æ‹Ÿç³»ç»Ÿï¼Œ
è¢«æ¬§ç›Ÿå§”å‘˜ä¼šã€è”åˆå›½ç²®å†œç»„ç»‡ç­‰å›½é™…æœºæ„å¹¿æ³›ä½¿ç”¨ã€‚è¯¥æ¨¡å‹
åœ¨200å¤šä¸ªå…¨çƒç«™ç‚¹è¿›è¡Œè¿‡æ ¡å‡†ï¼Œå…¶å‡†ç¡®æ€§å·²åœ¨1000å¤šç¯‡è®ºæ–‡ä¸­
å¾—åˆ°éªŒè¯ã€‚"

â†’ æ•™æˆå°†æ— æ³•è´¨ç–‘çœŸå®æ€§
â†’ é¡¹ç›®å­¦æœ¯å¯ä¿¡åº¦è´¨çš„é£è·ƒ
â†’ è®ºæ–‡æ–¹æ³•è®ºéƒ¨åˆ†å¯ä»¥å¼•ç”¨æƒå¨æ–‡çŒ®
    """)
    
    print("\n" + "="*70)
    print("ğŸ‰ æ€»ç»“")
    print("="*70)
    print("""
PCSE/WOFOSTæ˜¯è§£å†³æ•™æˆè´¨ç–‘çš„æœ€ä½³æ–¹æ¡ˆ:
âœ… å­¦æœ¯é‡‘æ ‡å‡†ï¼ˆ40å¹´ï¼Œ200+ç«™ç‚¹ï¼‰
âœ… ç°åœ¨å·²å®‰è£…ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨
âœ… 2-3å¤©å®Œæˆé›†æˆ
âœ… å¤§å¹…æå‡é¡¹ç›®å¯ä¿¡åº¦å’Œå½±å“åŠ›

å»ºè®®: æœ¬å‘¨æœ«å®Œæˆé›†æˆï¼Œä¸‹å‘¨ä¸€å±•ç¤ºç»™æ•™æˆ
    """)


def demo_pcse_simple_test():
    """
    ç®€å•æµ‹è¯•PCSEæ˜¯å¦æ­£å¸¸å·¥ä½œ
    """
    print("\n" + "="*70)
    print("ğŸ§ª PCSEåŠŸèƒ½æµ‹è¯•")
    print("="*70)
    
    try:
        print("\n1. æ£€æŸ¥PCSEç‰ˆæœ¬...")
        import pcse
        print(f"   âœ… PCSEç‰ˆæœ¬: {pcse.__version__}")
        
        print("\n2. æ£€æŸ¥å¯ç”¨æ¨¡å‹...")
        from pcse import models
        available_models = [m for m in dir(models) if not m.startswith('_')]
        print(f"   âœ… å¯ç”¨æ¨¡å‹: {len(available_models)}ä¸ª")
        for model in available_models[:5]:
            print(f"      - {model}")
        
        print("\n3. æ£€æŸ¥æ•°æ®æä¾›å™¨...")
        from pcse.db import NASAPowerWeatherDataProvider
        print("   âœ… NASA POWERå¤©æ°”æ•°æ®æä¾›å™¨å¯ç”¨")
        print("      (å¯è·å–å…¨çƒä»»æ„ä½ç½®çš„çœŸå®å†å²å¤©æ°”æ•°æ®)")
        
        print("\n4. æ£€æŸ¥ä½œç‰©æ•°æ®...")
        try:
            from pcse.input import YAMLCropDataProvider
        except ImportError:
            from pcse.fileinput import YAMLCropDataProvider
        print("   âœ… ä½œç‰©æ•°æ®æä¾›å™¨å¯ç”¨")
        print("      æ”¯æŒçš„ä½œç‰©: å°éº¦ã€ç‰ç±³ã€æ°´ç¨»ã€å¤§è±†ç­‰")
        
        print("\nâœ… PCSEæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸!")
        print("   â†’ å¯ä»¥å¼€å§‹é›†æˆå·¥ä½œ")
        
    except Exception as e:
        print(f"\nâŒ æµ‹è¯•å¤±è´¥: {e}")
        print("   è¯·æ£€æŸ¥PCSEå®‰è£…")


if __name__ == "__main__":
    demo_pcse_basic()
    demo_pcse_simple_test()
    
    print("\n" + "="*70)
    print("ğŸ“– ä¸‹ä¸€æ­¥é˜…è¯»:")
    print("   - docs/REAL_WORLD_SIMULATOR_UPGRADE.md (è¯¦ç»†å‡çº§æ–¹æ¡ˆ)")
    print("\nğŸ’» ä¸‹ä¸€æ­¥å®è·µ:")
    print("   - è¿è¡Œ: python demo_pcse_minimal_example.py (çœŸå®æ¨¡æ‹Ÿç¤ºä¾‹)")
    print("="*70)

